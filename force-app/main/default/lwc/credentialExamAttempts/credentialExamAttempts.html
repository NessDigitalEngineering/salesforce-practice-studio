<template>
    <lightning-card title={title}>
        <template if:true={emptyRecords}>
            <div class="slds-var-p-around_small slds-scrollable_y  setHeight">
                <table aria-describedby="" class="slds-table">
                    <thead></thead>
                    <tbody>
                        <template for:each={searchRecords} for:item="cred" for:index="index">
                            <tr class="slds-hint-parent" key={cred.Id}>
                                <th></th>
                                <td data-label="Credentials">

                                    <lightning-layout class="slds-box " vertical-align="center" horizontal-align="left"
                                        multiple-rows="true">
                                        <lightning-layout-item flexibility="auto" size="4" large-device-size="4"
                                            medium-device-size="4" small-device-size="4">
                                            <p class="slds-text-title_bold" title={label.ExamAttemptID}>
                                                {label.ExamAttemptID}
                                            </p>
                                        </lightning-layout-item>
                                        <lightning-layout-item flexibility="no-flex" size="4" large-device-size="4"
                                            medium-device-size="4" small-device-size="4">
                                            <p class="slds-text-title_bold">{cred.Name} </p>
                                        </lightning-layout-item>
                                        <lightning-layout-item flexibility="auto" size="4" large-device-size="4"
                                            medium-device-size="4" small-device-size="4">
                                            <template if:true={cred.showButton}>
                                                <div class="">
                                                    <button class="slds-button slds-button_brand  slds-button_stretch"
                                                        label={cred.buttonName} value={cred.Id}
                                                        onclick={handleClick}>{cred.buttonName}
                                                    </button>
                                                </div>
                                            </template>
                                        </lightning-layout-item>

                                        <lightning-layout-item flexibility="auto" size="4" large-device-size="4"
                                            medium-device-size="4" small-device-size="4">
                                            <p class="slds-truncate" title={label.User_Credential}>
                                                {label.User_Credential}</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item flexibility="no-flex" size="5" large-device-size="5"
                                            medium-device-size="5" small-device-size="5">
                                            <p class="slds-truncate">{cred.User_Credential__r.Name}</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item flexibility="auto" size="4" large-device-size="4"
                                            medium-device-size="4" small-device-size="4">
                                            <p class="slds-truncate" title={label.Credential_Name}>
                                                {label.Credential_Name}</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item flexibility="no-flex" size="5" large-device-size="5"
                                            medium-device-size="5" small-device-size="5">
                                            <p class="slds-truncate">{cred.Credential__c}</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item flexibility="auto" size="4" large-device-size="4"
                                            medium-device-size="4" small-device-size="4">
                                            <p class="slds-truncate" title={label.Exam_Date_Time}>{label.Exam_Date_Time}
                                            </p>
                                        </lightning-layout-item>
                                        <lightning-layout-item flexibility="no-flex" size="5" large-device-size="5"
                                            medium-device-size="5" small-device-size="5">
                                            <p class="slds-truncate">
                                                <template if:false={cred.editExamDate}>
                                                    <lightning-formatted-date-time value={cred.Exam_Date_Time__c}
                                                        time-zone={timeZone} year="numeric" month="numeric"
                                                        day="numeric">
                                                    </lightning-formatted-date-time>&nbsp;
                                                    <lightning-button-icon icon-name="utility:edit" value={cred.Id}
                                                        input-type="date" onclick={handleDateEdit} size="x-small">
                                                    </lightning-button-icon>
                                                </template>

                                                <template if:true={cred.editExamDate}>
                                                    <lightning-input type="date" name={cred.Id} data-name={cred.Id}
                                                        value={cred.Exam_Date_Time__c}>
                                                    </lightning-input>
                                                </template>

                                            </p>
                                        </lightning-layout-item>
                                        <lightning-layout-item flexibility="no-flex" size="3" large-device-size="3"
                                            medium-device-size="3" small-device-size="3">
                                            <p class="slds-truncate slds-p-left_small setMarginTop">
                                                <template if:true={cred.editExamDate}>
                                                    <lightning-button-icon icon-name="action:check" name={cred.Id}
                                                        value={cred.Id} onclick={handleActionCheck} size="x-small">
                                                    </lightning-button-icon>
                                                    &nbsp;
                                                    <lightning-button-icon icon-name="action:remove" value={cred.Id}
                                                        onclick={handleActionClose} size="x-small">
                                                    </lightning-button-icon>
                                                </template>

                                            </p>
                                        </lightning-layout-item>
                                        <lightning-layout-item flexibility="auto" size="4" large-device-size="4"
                                            medium-device-size="4" small-device-size="4">
                                            <p class="slds-truncate" title={label.Status}>{label.Status}</p>
                                        </lightning-layout-item>
                                        <lightning-layout-item flexibility="no-flex" size="5" large-device-size="5"
                                            medium-device-size="5" small-device-size="5">
                                            <p class="slds-truncate">{cred.Status__c}</p>
                                        </lightning-layout-item>
                                    </lightning-layout>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
<!-- Upload Result Modal PopUp -->
            <template if:true={displayUploadResultModal}>
              
                <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-describedby="modal-content-id-1"
                    aria-modal="true" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container" >
                        <header class="slds-modal__header">
                            <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                                title="Close" onclick={closeModal}>
                                <lightning-icon icon-name="utility:close" alternative-text="close" variant="inverse"
                                    size="small">
                                </lightning-icon>
                                <span class="slds-assistive-text">Close</span>
                            </button>
                            <h2 class="slds-text-heading_medium slds-hyphenate">
                                {label.Upload_Result}</h2>
                        </header>
                        <div class="slds-modal__content slds-p-around_medium">
                            <template if:true={showSpinner}>
                                <lightning-spinner alternative-text="Saving"></lightning-spinner>
                            </template>
                            <!-- <template for:each={response} for:item="result" for:index="index"> -->

                            <lightning-layout multiple-rows="true"  >
                                <lightning-layout-item size="12" padding="around-small" small-device-size="9"
                                    medium-device-size="6" large-device-size="6">
                                    <lightning-input class="" name="credential" value={Name}
                                        label={label.ExamAttemptID} disabled>
                                    </lightning-input>
                                </lightning-layout-item>

                                <lightning-layout-item size="12" padding="around-small" small-device-size="9"
                                    medium-device-size="6" large-device-size="6">
                                    <lightning-input class="" name="credential" value={Credential_Name}
                                        label={label.Credential_Name} disabled>
                                    </lightning-input>
                                </lightning-layout-item>

                                <lightning-layout-item size="12" padding="around-small" small-device-size="9"
                                    medium-device-size="6" large-device-size="6">
                                    <lightning-input class="dateInput slds-p-top_large" type="date" variant="label-hidden" required
                                        date-style="short" label={label.Exam_Date_Time}>
                                    </lightning-input>
                                </lightning-layout-item>

                                <lightning-layout-item size="12" padding="around-small" small-device-size="9"
                                    medium-device-size="6" large-device-size="6">
                                    <lightning-input class="" name="credential" label={label.Status} >
                                    </lightning-input>
                                </lightning-layout-item>

                                <lightning-layout-item size="12" padding="around-small" small-device-size="9"
                                    medium-device-size="6" large-device-size="6">
                                    <lightning-input type="file" multiple class=""
                                        accept=".docx, .pdf, .jpg, .txt, .png, .csv, .html, .zip" onchange={handleFileUpload}>
                                    </lightning-input>
        
                                    <div class="slds-m-around_small">
                                        <template if:true={filesData}>
                                            <template for:each={filesData} for:item="file" for:index="index">
                                                <lightning-pill key={file.fileName} label={file.fileName} data-id={index}
                                                    onclick={removeReceiptImage}></lightning-pill>
                                            </template>
                                        </template>
                                    </div>
                                </lightning-layout-item>

                            </lightning-layout>
                        <!-- </template>   -->

                        </div>
                        <footer class="slds-modal__footer">
                            <lightning-button class="button slds-p-right_small" variant="neutral" label="Cancel" onclick={closeModal}>
                            </lightning-button>
                            <lightning-button variant="brand" label="Save" onclick={saveNewRecord}>
                            </lightning-button>
                        </footer>
                    </div>
                </section>
            </template>
        
        </template>

        
        <template if:true={showIcon}>
            <div class="slds-text-align_center imgAdjustment">
                <img src={Icn} aria-hidden="true" alt="Assignment Logo"></img>
            </div>

            <div class="slds-text-align_center">
                <h2>{label.ExamAttempt_EmptyMsg}</h2><br>
            </div>
        </template>
    </lightning-card>
</template>
